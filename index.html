<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CUBIXX quiz</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
    #container { max-width: 500px; margin: 40px auto; background: #fff; padding: 2em; border-radius: 8px; box-shadow: 0 2px 8px #aaa; }
    h1 { text-align: center; }
    #login, #quiz, #done { display: none; }
    .question { margin-bottom: 2em; }
    .answers label { display: block; margin: 0.3em 0; }
    .btn { background: #0078d4; color: #fff; border: none; padding: 0.6em 1.2em; border-radius: 4px; cursor: pointer; }
    .btn:disabled { background: #ccc; }
    #progress { margin-bottom: 1em; }
  </style>
</head>
<body>
<div id="container">
  <h1>Daily Quiz</h1>
  <div id="login">
    <label>Enter your username:</label>
    <input id="username" type="text">
    <button id="loginBtn" class="btn">Login</button>
  </div>
  <div id="quiz">
    <div id="progress"></div>
    <div class="question">
      <div id="qtext"></div>
      <form id="answers" class="answers"></form>
    </div>
    <button id="nextBtn" class="btn" disabled>Next</button>
  </div>
  <div id="done">
    <h2>Quiz Complete!</h2>
    <div id="score"></div>
    <p>Come back tomorrow for 10 new questions!</p>
    <button id="logoutBtn" class="btn">Logout</button>
  </div>
</div>
<script>
const QUESTIONS_PER_DAY = 10;
const API_URL = "https://opentdb.com/api.php?amount=10&type=multiple";

let state = {
  username: null,
  currentQ: 0,
  score: 0,
  questions: [],
  today: null,
  answered: []
};

function saveProgress() {
  localStorage.setItem("quiz-"+state.username, JSON.stringify({
    today: state.today, currentQ: state.currentQ, score: state.score,
    questions: state.questions, answered: state.answered
  }));
}

function loadProgress(username) {
  let d = localStorage.getItem("quiz-"+username);
  return d ? JSON.parse(d) : null;
}

function fetchQuestions(cb) {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      let qs = data.results.map(q => {
        let choices = q.incorrect_answers.slice();
        let idx = Math.floor(Math.random() * 4);
        choices.splice(idx, 0, q.correct_answer);
        return {
          question: q.question,
          correct: q.correct_answer,
          choices: choices
        };
      });
      cb(qs);
    });
}

function showLogin() {
  document.getElementById("login").style.display = "block";
  document.getElementById("quiz").style.display = "none";
  document.getElementById("done").style.display = "none";
}
function showQuiz() {
  document.getElementById("login").style.display = "none";
  document.getElementById("quiz").style.display = "block";
  document.getElementById("done").style.display = "none";
}
function showDone() {
  document.getElementById("login").style.display = "none";
  document.getElementById("quiz").style.display = "none";
  document.getElementById("done").style.display = "block";
  document.getElementById("score").innerText = `Your score: ${state.score} / ${QUESTIONS_PER_DAY}`;
}

function todaysDateStr() {
  let d = new Date();
  return d.toISOString().slice(0,10);
}

function startQuiz() {
  state.currentQ = 0;
  state.score = 0;
  state.answered = [];
  showQuiz();
  showQuestion();
}

function showQuestion() {
  let q = state.questions[state.currentQ];
  document.getElementById("progress").innerText = `Question ${state.currentQ+1} of ${QUESTIONS_PER_DAY}`;
  document.getElementById("qtext").innerHTML = q.question;
  let answers = document.getElementById("answers");
  answers.innerHTML = "";
  q.choices.forEach((a, i) => {
    let id = "ans"+i;
    let radio = `<input type="radio" name="ans" id="${id}" value="${a}">`;
    let label = `<label for="${id}">${a}</label>`;
    answers.innerHTML += radio + label;
  });
  document.getElementById("nextBtn").disabled = true;
  document.querySelectorAll('input[name="ans"]').forEach(el => {
    el.addEventListener('change', () => {
      document.getElementById("nextBtn").disabled = false;
    });
  });
}

function handleNext() {
  let selected = document.querySelector('input[name="ans"]:checked');
  if (!selected) return;
  let ans = selected.value;
  let q = state.questions[state.currentQ];
  if (ans === q.correct) state.score++;
  state.answered.push(ans);
  state.currentQ++;
  saveProgress();
  if (state.currentQ < QUESTIONS_PER_DAY) {
    showQuestion();
  } else {
    saveProgress();
    showDone();
  }
}

function tryResumeQuiz() {
  let p = loadProgress(state.username);
  let today = todaysDateStr();
  if (p && p.today === today) {
    state.currentQ = p.currentQ;
    state.score = p.score;
    state.questions = p.questions;
    state.answered = p.answered;
    state.today = today;
    if (state.currentQ >= QUESTIONS_PER_DAY) {
      showDone();
    } else {
      showQuiz();
      showQuestion();
    }
  } else {
    fetchQuestions(qs => {
      state.currentQ = 0;
      state.score = 0;
      state.questions = qs;
      state.answered = [];
      state.today = today;
      saveProgress();
      startQuiz();
    });
  }
}

// Event handlers
document.getElementById("loginBtn").onclick = function() {
  let u = document.getElementById("username").value.trim();
  if (!u) { alert("Please enter a username."); return; }
  state.username = u;
  tryResumeQuiz();
};
document.getElementById("nextBtn").onclick = handleNext;
document.getElementById("logoutBtn").onclick = function() {
  state = { username: null, currentQ: 0, score: 0, questions: [], today: null, answered: [] };
  showLogin();
};

window.onload = showLogin;
</script>
</body>
  </html>
